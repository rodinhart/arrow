{"version":3,"sources":["vector/float.ts"],"names":[],"mappings":"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","file":"float.js","sourcesContent":["// Licensed to the Apache Software Foundation (ASF) under one\r\n// or more contributor license agreements.  See the NOTICE file\r\n// distributed with this work for additional information\r\n// regarding copyright ownership.  The ASF licenses this file\r\n// to you under the Apache License, Version 2.0 (the\r\n// \"License\"); you may not use this file except in compliance\r\n// with the License.  You may obtain a copy of the License at\r\n//\r\n//   http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing,\r\n// software distributed under the License is distributed on an\r\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n// KIND, either express or implied.  See the License for the\r\n// specific language governing permissions and limitations\r\n// under the License.\r\n\r\nimport { Data } from '../data';\r\nimport { Vector } from '../vector';\r\nimport { Chunked } from './chunked';\r\nimport { BaseVector } from './base';\r\nimport { VectorBuilderOptions } from './index';\r\nimport { vectorFromValuesWithType } from './index';\r\nimport { VectorBuilderOptionsAsync } from './index';\r\nimport { Float, Float16, Float32, Float64, FloatArray } from '../type';\r\nimport { VectorType as V, TypedArrayConstructor } from '../interfaces';\r\n\r\n/** @ignore */\r\ntype FloatVectorConstructors =\r\n    typeof FloatVector   |\r\n    typeof Float16Vector |\r\n    typeof Float32Vector |\r\n    typeof Float64Vector ;\r\n\r\n/** @ignore */\r\ntype FromInput<T extends Float, TNull = any> =\r\n    FloatArray                          |\r\n    Iterable<T['TValue'] | TNull>       |\r\n    AsyncIterable<T['TValue'] | TNull>  |\r\n    VectorBuilderOptions<T, TNull>      |\r\n    VectorBuilderOptionsAsync<T, TNull> ;\r\n\r\n/** @ignore */\r\ntype FloatArrayCtor = TypedArrayConstructor<FloatArray>;\r\n\r\n/** @ignore */\r\nexport class FloatVector<T extends Float = Float> extends BaseVector<T> {\r\n\r\n    // Guaranteed zero-copy variants\r\n    public static from(this: typeof FloatVector, input: Uint16Array): Float16Vector;\r\n    public static from(this: typeof FloatVector, input: Float32Array): Float32Vector;\r\n    public static from(this: typeof FloatVector, input: Float64Array): Float64Vector;\r\n\r\n    // Zero-copy if input is a TypedArray of the same type as the\r\n    // Vector that from is called on, otherwise uses the Builders\r\n    public static from<TNull = any>(this: typeof Float16Vector,  input: FromInput<Float16, TNull>): Float16Vector;\r\n    public static from<TNull = any>(this: typeof Float32Vector,  input: FromInput<Float32, TNull>): Float32Vector;\r\n    public static from<TNull = any>(this: typeof Float64Vector,  input: FromInput<Float64, TNull>): Float64Vector;\r\n\r\n    // Not zero-copy\r\n    public static from<T extends Float, TNull = any>(this: typeof FloatVector, input: Iterable<T['TValue'] | TNull>): V<T>;\r\n    public static from<T extends Float, TNull = any>(this: typeof FloatVector, input: AsyncIterable<T['TValue'] | TNull>): Promise<V<T>>;\r\n    public static from<T extends Float, TNull = any>(this: typeof FloatVector, input: VectorBuilderOptions<T, TNull>): Chunked<T>;\r\n    public static from<T extends Float, TNull = any>(this: typeof FloatVector, input: VectorBuilderOptionsAsync<T, TNull>): Promise<Chunked<T>>;\r\n    /** @nocollapse */\r\n    public static from<T extends Float, TNull = any>(this: FloatVectorConstructors, input: FromInput<T, TNull>) {\r\n\r\n        let ArrowType = vectorTypeToDataType(this);\r\n\r\n        if ((input instanceof ArrayBuffer) || ArrayBuffer.isView(input)) {\r\n            let InputType = arrayTypeToDataType(input.constructor as FloatArrayCtor) || ArrowType;\r\n            // Special case, infer the Arrow DataType from the input if calling the base\r\n            // FloatVector.from with a TypedArray, e.g. `FloatVector.from(new Float32Array())`\r\n            if (ArrowType === null) {\r\n                ArrowType = InputType;\r\n            }\r\n            // If the DataType inferred from the Vector constructor matches the\r\n            // DataType inferred from the input arguments, return zero-copy view\r\n            if (ArrowType && ArrowType === InputType) {\r\n                let type = new ArrowType();\r\n                let length = input.byteLength / type.ArrayType.BYTES_PER_ELEMENT;\r\n                // If the ArrowType is Float16 but the input type isn't a Uint16Array,\r\n                // let the Float16Builder handle casting the input values to Uint16s.\r\n                if (!convertTo16Bit(ArrowType, input.constructor)) {\r\n                    return Vector.new(Data.Float(type, 0, length, 0, null, input as FloatArray));\r\n                }\r\n            }\r\n        }\r\n\r\n        if (ArrowType) {\r\n            // If the DataType inferred from the Vector constructor is different than\r\n            // the DataType inferred from the input TypedArray, or if input isn't a\r\n            // TypedArray, use the Builders to construct the result Vector\r\n            return vectorFromValuesWithType(() => new ArrowType!() as T, input);\r\n        }\r\n\r\n        if ((input instanceof DataView) || (input instanceof ArrayBuffer)) {\r\n            throw new TypeError(`Cannot infer float type from instance of ${input.constructor.name}`);\r\n        }\r\n\r\n        throw new TypeError('Unrecognized FloatVector input');\r\n    }\r\n}\r\n\r\n/** @ignore */\r\nexport class Float16Vector extends FloatVector<Float16> {\r\n    // Since JS doesn't have half floats, `toArray()` returns a zero-copy slice\r\n    // of the underlying Uint16Array data. This behavior ensures we don't incur\r\n    // extra compute or copies if you're calling `toArray()` in order to create\r\n    // a buffer for something like WebGL. Buf if you're using JS and want typed\r\n    // arrays of 4-to-8-byte precision, these methods will enumerate the values\r\n    // and clamp to the desired byte lengths.\r\n    public toFloat32Array() { return new Float32Array(this as Iterable<number>); }\r\n    public toFloat64Array() { return new Float64Array(this as Iterable<number>); }\r\n}\r\n\r\n/** @ignore */\r\nexport class Float32Vector extends FloatVector<Float32> {}\r\n/** @ignore */\r\nexport class Float64Vector extends FloatVector<Float64> {}\r\n\r\nconst convertTo16Bit = (typeCtor: any, dataCtor: any) => {\r\n    return (typeCtor === Float16) && (dataCtor !== Uint16Array);\r\n};\r\n\r\n/** @ignore */\r\nconst arrayTypeToDataType = (ctor: FloatArrayCtor) => {\r\n    switch (ctor) {\r\n        case Uint16Array:    return Float16;\r\n        case Float32Array:   return Float32;\r\n        case Float64Array:   return Float64;\r\n        default: return null;\r\n    }\r\n};\r\n\r\n/** @ignore */\r\nconst vectorTypeToDataType = (ctor: FloatVectorConstructors) => {\r\n    switch (ctor) {\r\n        case Float16Vector: return Float16;\r\n        case Float32Vector: return Float32;\r\n        case Float64Vector: return Float64;\r\n        default: return null;\r\n    }\r\n};\r\n"]}